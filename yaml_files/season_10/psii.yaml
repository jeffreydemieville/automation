
tags:
  pipeline: season10_psii
  description: dev
  notes: Processing of Season 10 psii data
  runby: Travis Simmons
  sensor: psii 
  season: 10

modules:
  1:
    container: 
      simg_name: psii_bin_to_tif.simg
      dockerhub_path: docker://phytooracle/psii_bin_to_tif:latest
    command:  singularity run psii_bin_to_tif.simg $FILE -m $SUB_DIR/$UUID_metadata.json
    distribution_level: local
    file_level:
    input_dir: [./$RAW_DATA_PATH]
    input_file: .bin
    inputs: [$FILE,
             $SUB_DIR/$UUID_metadata.json]
    outputs: [bin2tif_out/$FILE_BASE.tif,
             ]

  2:
    container: 
      simg_name: rgb_flir_plot_clip_geojson.simg
      dockerhub_path: docker://phytooracle/rgb_flir_plot_clip_geojson:latest
    command: singularity run rgb_flir_plot_clip_geojson.simg $FILE -sen psii -shp ./season10_multi_latlon_geno.geojson
    distribution_level: local
    file_level: 
    input_dir: [./bin2tif_out]
    input_file: .tif
    inputs: [$FILE, season10_multi_latlon_geno.geojson]
    outputs: []             
  

#  3:
#     container: 
#       simg_name: rgb_flir_plot_clip_geojson.simg
#       dockerhub_path: docker://phytooracle/rgb_flir_plot_clip_geojson:latest
#     command: singularity run $FILE -sen psii -shp ./season10_multi_latlon_geno.geojson
#     distribution_level: local
#     file_level: 
#     input_dir: [./bin2tif_out]
#     input_file: .tif
#     inputs: [$FILE, season10_multi_latlon_geno.geojson]
#     outputs: []  


workload_manager:
  account: dukepauli
  partition: standard
  job_name: phytooracle_worker
  nodes: 1
  number_worker_array: 400
  cores_per_worker: 50
  time_minutes: 4320
  retries: 1
  port: 0
  mem_per_core: 5
  manager_name: phytooracle_manager_emmanuel
  worker_timeout_seconds: 900 #86400

paths:
  models:
    detection: /iplant/home/shared/phytooracle/season_10_lettuce_yr_2020/level_0/necessary_files/detecto_heatmap_lettuce_detection_weights.pth
    segmentation: /iplant/home/shared/phytooracle/season_10_lettuce_yr_2020/level_0/necessary_files/detecto_heatmap_lettuce_detection_weights.pth
  pipeline_outpath: [individual_plants_out]
  outpath_subdirs: [east, east_downsampled, plant_reports, segmentation_pointclouds, west, west_downsampled, 3d_volumes_entropy_v007]

  cyverse: 
    input: 
      basename: /iplant/home/shared/phytooracle/season_10_lettuce_yr_2020/level_0/ps2Top/
      subdir: 
      prefix: ps2Top-
      suffix: .tar
    output: 
      basename: /iplant/home/travis_simmons/
      subdir: analyses
