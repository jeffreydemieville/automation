
tags:
  pipeline: season10_psii
  description: dev
  notes: Processing of Season 10 ps2Top data
  runby: Travis Simmons
  sensor: ps2Top
  season: 10
  season_name: season_10_lettuce_yr_2020

modules:
  1:
    container: 
      simg_name: psii_bin_to_tif.simg
      dockerhub_path: docker://phytooracle/psii_bin_to_tif:latest
    command:  singularity run psii_bin_to_tif.simg ${FILE} -m ${SUB_DIR}/${UUID}_metadata.json
    distribution_level: local
    file_level:
    input_dir: [./$RAW_DATA_PATH]
    input_file: .bin
    inputs: [$FILE,
             $SUB_DIR/$UUID_metadata.json]
    outputs: [bin2tif_out/$FILE_BASE.tif,
             ]

  2:
    container: 
      simg_name: rgb_flir_plot_clip_geojson.simg
      dockerhub_path: docker://phytooracle/rgb_flir_plot_clip_geojson:latest
    command: singularity run rgb_flir_plot_clip_geojson.simg ${FILE} -sen psii -shp ./season10_multi_latlon_geno.geojson
    distribution_level: local
    file_level: 
    input_dir: [./bin2tif_out]
    input_file: .tif
    inputs: [$FILE, level_0/season10_multi_latlon_geno.geojson]
    outputs: []             
  

#  3:
#     container: 
#       simg_name: segmentation.simg
#       dockerhub_path: docker://phytooracle/
#     command: singularity run 
#     distribution_level: local
#     file_level: 
#     input_dir: []
#     input_file: 
#     inputs: []
#     outputs: []  


workload_manager:
  account: dukepauli
  partition: standard
  job_name: phytooracle_worker
  nodes: 1
  number_worker_array: 400
  cores_per_worker: 50
  time_minutes: 4320
  retries: 1
  port: 0
  mem_per_core: 5
  manager_name: phytooracle_manager_travis
  worker_timeout_seconds: 900 #86400

paths:
  models:
    detection: /iplant/home/shared/phytooracle/season_10_lettuce_yr_2020/level_0/necessary_files/detecto_heatmap_lettuce_detection_weights.pth
    segmentation: /iplant/home/shared/phytooracle/season_10_lettuce_yr_2020/level_0/necessary_files/detecto_heatmap_lettuce_detection_weights.pth
  pipeline_outpath: [.]
  outpath_subdirs: [bin2tif_out, plotclip_out]

  cyverse:
    basename: /iplant/home/shared/phytooracle/
    input: 
      level: level_0
      input_dir: []
      necessary_files: [level_0/season10_multi_latlon_geno.geojson]
    output:
      level: level_1
    #   subdir: 
    #   prefix: ps2Top-
    #   suffix: .tar
    # output: 
    #   basename: /iplant/home/travis_simmons/
    #   subdir: 
